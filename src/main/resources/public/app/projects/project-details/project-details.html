<div class="viewContentWrapper" layout="column">

    <div layout="row" style="width: 100%;">
        <div flex-gt-md=30 flex-md=20 flex-sm=5 flex-xs=5></div>

        <div flex-gt-md=40 flex-md=60 flex-sm=90 flex-xs=90 layout="column">

            <div class="detailsSectionHeader">Project Details</div>

            <section class="detailsSectionContent">
                <md-input-container style="width: 100%;">
                    <label>Description</label>
                    <input type="text" ng-model="project.description" ng-change="$root.onFormElementChange('projectRequestDto_description')"
                    ng-disabled="!isAdmin">
                    <span ng-show="$root.formElementsErrors.projectRequestDto_description" class="formItemErrorMessage" style="display: initial !important;">{{$root.formElementsErrors.projectRequestDto_description}}</span>
                    <md-button ng-if="isAdmin" type="submit" id="submitBtn" ng-click="onSubmitProjectChanges()" class="md-raised md-primary detailsSectionButton">Save</md-button>
                </md-input-container>
            </section>

            <div ng-if="isAdmin" class="detailsSectionHeader">Assigned Users</div>
            <section ng-if="isAdmin" class="detailsSectionContent">
                <div ng-repeat="projectUser in projectUsers" class="detailsSectionListItem">
                    <div layout="row" layout-align="space-between center">
                        <div>{{projectUser.username}}</div>
                        <i class="fa fa fa-times detailsSectionActionIcon" ng-click="onUnassignUser($index)"></i>
                    </div>
                    <div style="margin-bottom: 14px;">
                        <md-chips ng-model="projectUser.roles" md-autocomplete-snap md-require-match="true">
                            <md-autocomplete md-search-text="projectUser.roleSearchText" md-items="item in searchProjectRole(projectUser.roleSearchText)"
                            md-item-text="item.name" placeholder="Search for a role">
                                <span md-highlight-text="projectUser.roleSearchText">{{item.roleName}}</span>
                            </md-autocomplete>
                            <md-chip-template>
                                <span>{{$chip.roleName}}
                         </span>
                            </md-chip-template>
                        </md-chips>
                    </div>

                    <div style="margin-bottom: 14px;">
                        <md-chips ng-model="projectUser.groups" md-autocomplete-snap md-require-match="false" md-transform-chip="transformGroupChip($chip)">
                            <md-autocomplete md-search-text="projectUser.groupSearchText" md-items="item in searchProjectGroup(projectUser.groupSearchText)"
                            md-item-text="item.name" placeholder="Search for a group" md-no-cache="true">
                                <span md-highlight-text="projectUser.groupSearchText">{{item.groupName}}</span>
                            </md-autocomplete>
                            <md-chip-template>
                                <span>{{$chip.groupName}}
                         </span>
                            </md-chip-template>
                        </md-chips>
                    </div>
                    <div layout="row" layout-align="end">
                        <md-button type="submit" id="submitBtn" ng-click="onChangeAssignedUserRolesAndGroups($index)" class="md-raised md-primary detailsSectionButton">Save</md-button>
                    </div>
                </div>
            </section>

            <div ng-if="isAdmin" class="detailsSectionHeader">Invite a new user</div>

            <section ng-if="isAdmin" class="detailsSectionContent">
                <md-input-container style="width: 100%;">
                    <label>Send to email</label>
                    <input type="email" ng-model="invitation.email" ng-change="$root.onFormElementChange('invitationRequestDto_email')">
                    <span ng-show="$root.formElementsErrors.invitationRequestDto_email" class="formItemErrorMessage" style="display: initial !important;">{{$root.formElementsErrors.invitationRequestDto_email}}</span>
                </md-input-container>

                <div style="margin-bottom: 14px;">
                    <md-chips ng-model="invitation.roles" md-autocomplete-snap md-require-match="true">
                        <md-autocomplete md-search-text="invitation.roleSearchText" md-items="item in searchProjectRole(invitation.roleSearchText)"
                        md-item-text="item.name" placeholder="Search for a role">
                            <span md-highlight-text="invitation.roleSearchText">{{item.roleName}}</span>
                        </md-autocomplete>
                        <md-chip-template>
                            <span>{{$chip.roleName}}
                         </span>
                        </md-chip-template>
                    </md-chips>
                </div>

                <div style="margin-bottom: 14px;">
                    <md-chips ng-model="invitation.groups" md-autocomplete-snap md-require-match="false" md-transform-chip="transformGroupChip($chip)">
                        <md-autocomplete md-search-text="invitation.groupSearchText" md-items="item in searchProjectGroup(invitation.groupSearchText)"
                        md-no-cache="true" md-item-text="item.name" placeholder="Search for a group">
                            <span md-highlight-text="invitation.groupSearchText">{{item.groupName}}</span>
                        </md-autocomplete>
                        <md-chip-template>
                            <span>{{$chip.groupName}}
                         </span>
                        </md-chip-template>
                    </md-chips>
                </div>

                <div layout="row">
                    <div layout="row" layout-align="end" style="width: 100%;">
                        <md-button ng-if="isAdmin" type="submit" id="submitBtn" ng-click="onSendInvitation()" class="md-raised md-primary detailsSectionButton">Save</md-button>
                    </div>
                </div>
            </section>

            <div ng-if="isAdmin && pendingInvitations.length > 0" class="detailsSectionHeader">Pending invitations</div>

            <section ng-if="isAdmin && pendingInvitations.length > 0" class="detailsSectionContent">
                <div ng-repeat="invitation in pendingInvitations" class="detailsSectionListItem">
                    <div layout="column">
                        <div layout="row">
                            <span flex=30>Recipient: </span>
                            <span flex=70 style="margin-bottom: 0.5rem;">{{invitation.email}}</span>
                        </div>
                        <div layout="row">
                            <span flex=30>Created by: </span>
                            <span flex=70 style="margin-bottom: 0.5rem;">{{invitation.createdBy}}</span>
                        </div>
                        <div layout="row">
                            <span flex=30>Creation date: </span>
                            <span flex=70 style="margin-bottom: 0.5rem;">{{invitation.createdAt | date:'yyyy-MM-dd'}}</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div flex-gt-md=30 flex-md=20 flex-sm=5 flex-xs=5></div>
    </div>
</div>